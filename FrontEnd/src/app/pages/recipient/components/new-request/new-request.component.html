<!-- Fullscreen blurred backdrop and scrollable -->
<div class="fixed inset-0 z-40 overflow-y-auto backdrop-blur-sm bg-white/30">
  <div class="min-h-screen flex flex-col items-center justify-start py-10 px-4">
    
    <div class="bg-white p-6 rounded shadow-md max-w-2xl w-full relative">
      
      <!-- ‚ùå Close button -->
      <button 
        class="absolute top-2 right-3 text-red-600 text-2xl font-bold hover:text-red-800"
        (click)="onCloseClick()"
        aria-label="Close form">
        &times;
      </button>
      
      <!-- Heading -->
      <h2 class="text-2xl font-semibold mb-4">New Blood Request</h2>
      
      <!-- Success Message -->
      <div *ngIf="submitSuccess" class="mb-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
        <p class="font-medium">‚úÖ Request submitted successfully!</p>
        <p class="text-sm">Your blood request has been submitted and is now pending approval.</p>
      </div>
      
      <!-- Error Message -->
      <div *ngIf="submitError" class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
        <p class="font-medium">‚ùå Error</p>
        <p class="text-sm">{{ submitError }}</p>
      </div>
      
      <!-- üìã Form -->
      <form [formGroup]="bloodRequestForm" (ngSubmit)="onSubmit()" class="space-y-4">
        
        <!-- Blood Group Field -->
        <div>
          <label class="block mb-1 font-medium">Blood Group *</label>
          <select 
            formControlName="bloodGroup"
            class="w-full border rounded p-2"
            [class.border-red-500]="hasError('bloodGroup', 'required')">
            <option value="">Select blood group</option>
            <option *ngFor="let group of bloodGroups" [value]="group">{{ group }}</option>
          </select>
          
          <div *ngIf="hasError('bloodGroup', 'required')" class="text-red-500 text-sm mt-1">
            Blood group is required
          </div>
        </div>
        
        <!-- Urgency Field -->
        <div>
          <label class="block mb-1 font-medium">Urgency *</label>
          <select 
            formControlName="urgencyLevel"
            class="w-full border rounded p-2"
            [class.border-red-500]="hasError('urgencyLevel', 'required')">
            <option value="">Select urgency</option>
            <option *ngFor="let level of urgencyLevels" [value]="level.value">
              {{ level.label }}
            </option>
          </select>
          
          <div *ngIf="hasError('urgencyLevel', 'required')" class="text-red-500 text-sm mt-1">
            Urgency level is required
          </div>
        </div>
        
        <!-- Hospital Name Field -->
        <div>
          <label class="block mb-1 font-medium">Hospital Name *</label>
          <input 
            type="text" 
            formControlName="hospitalName"
            class="w-full border rounded p-2"
            [class.border-red-500]="hasError('hospitalName', 'required')"
            placeholder="Enter hospital name" />
          
          <div *ngIf="hasError('hospitalName', 'required')" class="text-red-500 text-sm mt-1">
            Hospital name is required
          </div>
        </div>
        
        <!-- Hospital Address Field -->
        <div>
          <label class="block mb-1 font-medium">Hospital Address *</label>
          <input 
            type="text" 
            formControlName="hospitalAddress"
            class="w-full border rounded p-2"
            [class.border-red-500]="hasError('hospitalAddress', 'required')"
            placeholder="Enter hospital address" />
          
          <div *ngIf="hasError('hospitalAddress', 'required')" class="text-red-500 text-sm mt-1">
            Hospital address is required
          </div>
        </div>
        
        <!-- Contact Number Field -->
        <div>
          <label class="block mb-1 font-medium">Contact No. *</label>
          <input 
            type="tel" 
            formControlName="contactNumber"
            class="w-full border rounded p-2"
            [class.border-red-500]="hasError('contactNumber', 'required') || hasError('contactNumber', 'pattern')"
            placeholder="Enter 10-digit contact number" />
          
          <div *ngIf="hasError('contactNumber', 'required')" class="text-red-500 text-sm mt-1">
            Contact number is required
          </div>
          <div *ngIf="hasError('contactNumber', 'pattern')" class="text-red-500 text-sm mt-1">
            Please enter a valid 10-digit contact number
          </div>
        </div>
        
        <!-- Reason Field -->
        <div>
          <label class="block mb-1 font-medium">Reason *</label>
          <textarea 
            formControlName="reason"
            class="w-full border rounded p-2"
            [class.border-red-500]="hasError('reason', 'required') || hasError('reason', 'minlength')"
            rows="3"
            placeholder="Describe the reason for blood requirement"></textarea>
          
          <div *ngIf="hasError('reason', 'required')" class="text-red-500 text-sm mt-1">
            Reason is required
          </div>
          <div *ngIf="hasError('reason', 'minlength')" class="text-red-500 text-sm mt-1">
            Reason must be at least 10 characters
          </div>
        </div>
        
        <!-- Submit Button -->
        <button
          type="submit"
          [disabled]="isSubmitting || submitSuccess"
          class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed">
          
          <span *ngIf="isSubmitting" class="flex items-center">
            <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Submitting...
          </span>
          
          <span *ngIf="!isSubmitting && !submitSuccess">Submit Request</span>
          <span *ngIf="submitSuccess">‚úÖ Submitted</span>
        </button>
        
      </form>
      
      <!-- üîí Confirmation Modal -->
      <div *ngIf="showConfirm" class="fixed inset-0 flex items-center justify-center z-50 backdrop-blur-sm bg-white/30">
        <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full border border-gray-200">
          <h3 class="text-lg font-semibold text-gray-800 mb-2">Are you sure?</h3>
          <p class="text-sm text-gray-600 mb-4">
            This will close the form and discard any unsaved changes.
          </p>
          <div class="flex justify-end gap-3">
            <button 
              class="px-4 py-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400"
              (click)="cancelClose()">
              Cancel
            </button>
            <button 
              class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
              (click)="confirmClose()">
              Yes, Close
            </button>
          </div>
        </div>
      </div>
      
    </div>
  </div>
</div>